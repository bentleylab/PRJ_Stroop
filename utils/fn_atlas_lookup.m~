function [elec_lab] = fn_atlas_lookup(elec, atlas)
% generate a list of roi_labels for a given elec struct and atlas
% INPUTS:
%   elec [struct] - elec struct
%   atlas [struct] - atlas loaded from ft_read_atlas


% edit generate_electable.m % more extensive version

%% Find ROI Labels of electrodes (Create elec table)
elec_lab = elec;

cfg = [];
cfg.atlas = atlas;
cfg.inputcoord = elec.coordsys;
cfg.output = 'single';
cfg.maxqueryrange = 5;
for e = 1:numel(elec.label);
    % Search for this elec
    cfg.roi = elec.chanpos(e,:);
    report = ft_volumelookup(cfg,atlas);
    
    % Report label for this elec
    [tmp ind] = sort(report.count,1,'descend');
    sel = find(tmp);
    for j=1:length(sel);
        found{j} = report.name{ind(j)};%[num2str(report.count(ind(j))) ': ' report.name{ind(j)}];
    end
    roi_labels{e} = strjoin(found,',');
    elec_lab.
end

nf_cnt = 0;
for e = 1:numel(elec.label)
    disp([num2str(e) ': ' elec.label{e} ' = ' roi_labels{e}]);
    if ~isempty(strfind(roi_labels{e},'no_label_found'))
        nf_cnt= nf_cnt+1;
    end
end
disp(['nf_cnt = ' num2str(nf_cnt)]);
% % Import atlas of interest
% atlas = ft_read_atlas([ft_dir 'template/atlas/aal/ROI_MNI_V4.nii']);
% [~, indx] = max(labels.count);
% labels.name(indx)


end


