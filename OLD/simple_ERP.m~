%% Stroop analysis - Simple ERPs

cd('/home/knight/kla/Desktop/stroop/S02IR21/03_fulldata/');
load('S02IR21_RAC.mat');

n_chan = size(data_ecog,1);
n_trials = size(trial_info.condition_n,2);
% con = 1-3, neu = 4-6, inc = 7-9
% within those: same, mic, mcon
% trial_type = NaN(size(trial_info.condition_n));
max_RT = max(trial_info.response_time); % in sec

%% Cut trials
buff_pre = 1000;
buff_post = 1500;
trials_stim = NaN([n_chan,n_trials,buff_pre+buff_post+1]);
trials_resp = NaN([n_chan,n_trials,buff_pre+buff_post+1]);
for c = 1:n_chan
    for t = 1:n_trials
        trials_stim(c,t,:) = data_ecog(chan,trial_info.word_onset(t)-buff_pre:trial_info.word_onset(t)+buff_post);
        if ~isnan(trial_info.resp_onset(t))
            trials_resp(c,t,:) = data_ecog(chan,trial_info.resp_onset(t)-buff_pre:trial_info.resp_onset(t)+buff_post);
        end
    end
end

%% ERPs by condition
con_idx = [trial_info.condition_n==1]+[trial_info.condition_n==2]+[trial_info.condition_n==3];
neu_idx = [trial_info.condition_n==4]+[trial_info.condition_n==5]+[trial_info.condition_n==6];
inc_idx = [trial_info.condition_n==7]+[trial_info.condition_n==8]+[trial_info.condition_n==9];

mean_con_stim = nanmean(trials_stim(:,con_idx==1,:),3);
mean_neu_stim = nanmean(trials_stim(:,neu_idx==1,:),3);
mean_inc_stim = nanmean(trials_stim(:,inc_idx==1,:),3);

mean_con_resp = nanmean(trials_resp(:,con_idx==1,:),3);
mean_neu_resp = nanmean(trials_resp(:,neu_idx==1,:),3);
mean_inc_resp = nanmean(trials_resp(:,inc_idx==1,:),3);

figure;
for ch = 1:n_chan
    subplot(n_chan,2,ch*2-1); hold on;
    plot(mean_con_stim,'r');
    plot(mean_neu_stim,'k');
    plot(mean_inc_stim,'b');
    line([1000, 1000],ylim);%, 'k--');
    title(strcat('Stim Locked',header_ecog.channel_labels(ch)));
    legend('con','neu','inc','stim');
    
    subplot(n_chan,2,ch*2); hold on;
    plot(mean_con_resp,'r');
    plot(mean_neu_resp,'k');
    plot(mean_inc_resp,'b');
    line([1000, 1000],ylim);%, 'k--');
    title('Resp Locked',header_ecog.channel_labels(ch)));
    legend('con','neu','inc','resp');
end